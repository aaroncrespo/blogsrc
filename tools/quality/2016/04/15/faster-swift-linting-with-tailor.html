<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title> Faster Swift Linting with Tailor —  &raquo;  Aaron C.</title>
<meta name="description" content="Aaron's Blahg">
<meta name="keywords" content="">
<link rel="canonical" href="https://aaroncrespo.com/tools/quality/2016/04/15/faster-swift-linting-with-tailor.html">
        




<!-- Twitter Cards -->
<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Faster Swift Linting with Tailor" />
<meta name="twitter:description" content="Aaron's Blahg" />
<meta name="twitter:image" content="https://aaroncrespo.com" />

<!-- Google plus -->
<meta name="author" content="">
<link rel="author" href="">

<!-- Open Graph -->
<meta property="og:locale" content="">
<meta property="og:type" content="article">
<meta property="og:title" content="Faster Swift Linting with Tailor">
<meta property="og:description" content="Aaron's Blahg">
<meta property="og:url" content="https://aaroncrespo.com/tools/quality/2016/04/15/faster-swift-linting-with-tailor.html">
<meta property="og:site_name" content="Aaron C.">

        <link href='http://fonts.googleapis.com/css?family=Inconsolata:400,700' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="/assets/vendor/normalize-css/normalize.css">
<link rel="stylesheet" href="/css/main.css">

  <link rel="stylesheet" href="/assets/vendor/highlight/styles/solarized_dark.css">

<link rel="stylesheet" href="/assets/vendor/font-awesome/css/font-awesome.css">
    </head>

    <body>
        <div class="wrapper">
            <header class="header">
    <div class="navigation">
        <a href="/" class="logo">Aaron C.</a>

        <ul class="menu">
            <li class="menu__entry"><a href="/about">About</a></li>
            <li class="menu__entry"><a href="/">Blog</a></li>
        </ul>
    </div>

    <ul class="social-links">
        
            <a href="https://github.com/aaroncrespo" class="social-links__entry" target="_blank">
                <i class="fa fa-github"></i>
            </a>
        

        
            <a href="https://twitter.com/aaroncrespo" class="social-links__entry" target="_blank">
                <i class="fa fa-twitter"></i>
            </a>
        
    </ul>
</header>

            <h1 class="page-title post-title">
    <div class="page-title__text post-title__text">Faster Swift Linting with Tailor</div>
    <div class="page-title__subtitle post-title__subtitle"></div>
</h1>

<div class="content">
    <p>Linting is a good practice that helps make code reviews smoother. On linted code we can focus reviews on what the code is actually doing over what the code looks like. It also acts as a hedge against bike-shedding in a project and we can focus the review on the big ideas in the change. If we ever need discussion around code formatting some people have a strong “tabs vs spaces” opinion. Our style guide and lint rules are their own git repository a these discussions happen in there separate from the code that is subject to it.</p>

<h1 id="introducing-tailorsh">Introducing Tailor.sh</h1>

<p>We use <a href="https://tailor.sh"><code class="highlighter-rouge">tailor.sh</code></a> to run these quick formatting checks against our Swift style guide. In a recent project we noticed lint processing times were growing at a steady enough pace, to the point where sometimes we would turn off and forget to turn it back on. We looked at how <code class="highlighter-rouge">tailor.sh</code> worked and noticed it would lint files that passed earlier checks but were not modified. We looked for flags to pass in to change this behavior, but ended up solving it on the input side.</p>

<h1 id="code">Code</h1>

<p>The default tailor integration is a small bash script executed as part of a build phase:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">if </span><span class="nb">hash </span>tailor 2&gt;/dev/null; <span class="k">then
    </span>tailor
<span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"warning: Please install Tailor from https://tailor.sh"</span>
<span class="k">fi</span>
</code></pre>
</div>

<p>We updated this to trim input into tailor and become more efficient with our time while working on a large swift project.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">if </span><span class="nb">hash </span>tailor 2&gt;/dev/null; <span class="k">then
    </span><span class="nv">FILES</span><span class="o">=</span><span class="sb">`</span><span class="o">(</span>git ls-files -mo --exclude-standard; git diff origin/HEAD --diff-filter<span class="o">=</span>ACMRUXB --name-only<span class="o">)</span> 
            | grep swift<span class="sb">`</span>

    <span class="k">if</span> <span class="o">[</span> -n <span class="s2">"</span><span class="nv">$FILES</span><span class="s2">"</span> <span class="o">]</span>; <span class="k">then
        </span><span class="nb">echo</span> <span class="nv">$FILES</span> | xargs tailor
    <span class="k">fi
else
    </span><span class="nb">echo</span> <span class="s2">"warning: Please install Tailor from https://tailor.sh"</span>
<span class="k">fi</span>
</code></pre>
</div>

<h1 id="breaking-it-down">Breaking it down</h1>

<ol>
  <li>The <code class="highlighter-rouge">if hash .. then .. fi</code> is gracefully handling tailor not being installed.</li>
  <li>Next We are going to store all our dirty or new files in a local Bash variable <code class="highlighter-rouge">FILES</code></li>
  <li>Next is where it differs from the default
    <ul>
      <li><code class="highlighter-rouge">git ls-files -mo --exclude-standard</code> <br />
  A flat list of files, showing modified <code class="highlighter-rouge">-m</code> and untracked <code class="highlighter-rouge">-o</code>, <code class="highlighter-rouge">--exclude-standard</code> respecting your .gitignore.</li>
      <li><code class="highlighter-rouge">git diff origin/HEAD --diff-filter=ACMRUXB --name-only</code><br />
  A diff of the local content against the <code class="highlighter-rouge">HEAD</code> of your default remote repository. Showing only the file names of any different files except deleted.  A <code class="highlighter-rouge">D</code> option in the diff-filter option would show deleted files and is a default)</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">() |</code> Combine the output of the first two git commands and send that into</li>
  <li><code class="highlighter-rouge">grep swift</code> We only want to run Swift files into tailor. So filter any file that isn’t Swift source code.</li>
  <li>The <code class="highlighter-rouge">xargs</code> step just allows us to skip tailor all together if there is nothing to tailor.</li>
</ol>

<h1 id="notes">Notes</h1>

<p>The reason we use two separate git commands is that we like to see tailor results against our remote even if all local changes are added to the local index. Files aren’t listed in <code class="highlighter-rouge">git ls-files</code> with our options once added to the index.<br />
We use <code class="highlighter-rouge">git ls-files</code> over <code class="highlighter-rouge">git status</code> because we don’t particularly care about the status of a file which git status provides per file. Rather we want a list of files matching our criteria.</p>

<p>#Finally<br />
Recently <code class="highlighter-rouge">tailor.sh</code> added parallel processing so running this task happens on multiple files at once, earlier versions of tailor processed one file at a time and when run as a compile step iteration times where much higher. <br />
Running 4 times as fast can still eat up surprising amounts of time when you are trying to run tight iteration cycles.</p>

</div>

<div class="about">
    <div class="about__devider">*****</div>
    <div class="about__text">
        Written by <strong>  Aaron C. </strong>
        on <strong>15 April 2016</strong>
    </div>
</div>


        </div>

        <script src="/assets/vendor/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
        
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-32863879-1', 'auto');
      ga('send', 'pageview');
    </script>

    </body>
</html>
